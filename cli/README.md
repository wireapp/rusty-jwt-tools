# rusty-jwt-cli

A cli to prototype JWTs and tryout this project.

## Installation

```bash
cargo install --git https://github.com/wireapp/rusty-jwt-tools.git
```

To update do:
```bash
cargo install --force --git https://github.com/wireapp/rusty-jwt-tools.git
```

## Generate PEM KeyPairs

### Ed25519

```bash
openssl genpkey -algorithm ed25519 -outform PEM -out kp-ed25519.pem
```

### ES256

```bash
openssl ecparam -genkey -name prime256v1 | openssl pkcs8 -topk8 -nocrypt -out kp-p256.pem 
```

### ES384

```bash
openssl ecparam -genkey -name secp384r1 | openssl pkcs8 -topk8 -nocrypt -out kp-p384.pem 
```

## Usage

### `jwt-build`

Generates a new JWT token. For sample payloads have a look in [this folder](../data).

```bash
cat claims.json | rusty-jwt-cli jwt-build -k kp-ed25519.pem -p vp.json -c vc1.json -c vc2.json
# or
rusty-jwt-cli jwt-build claims.json -k kp-ed25519.pem -p vp.json -c vc1.json -c vc2.json
```

### `jwt-parse`

Introspects and verifies a JWT token

```bash
cat jwt.json | rusty-jwt-cli jwt-parse
# or
rusty-jwt-cli jwt-parse jwt.json
```

### `jwk-parse`

Turns a PEM private into its public key JWK representation and computes its thumbprint according to RFC7638.

```bash
cat kp-p256.pem | rusty-jwt-cli jwk-parse
# or
rusty-jwt-cli jwk-parse kp-p256.pem
```

### `access-verify`

Verifies an access token generated by wire-server. To generate a sample one you can

```bash
git clone https://github.com/wireapp/rusty-jwt-tools.git &&
cd rusty-jwt-tools &&
cargo test --test e2e -- --show-output
```

For example for an Ed25519 token let store it in a file

```bash
cat <<EOF >> access-pk.pem
-----BEGIN PUBLIC KEY-----
MCowBQYDK2VwAyEAKG4odfk6mCgwi8QscttETsh9tPFGsSX9pKTyXPOlKi4=
-----END PUBLIC KEY-----
EOF
```

And verify it like this

```bash
rusty-jwt-cli verify-access access-token.txt \
--client-id wireapp://lJGYPz0ZRq2kvc_XpdaDlA!211a945dca45eed1@wire.com \
--challenge okAJ33Ym/XS2qmmhhh7aWSbBlYy4Ttm1EysqW8I/9ng \
--leeway 360 \
--max-expiry 2080200819 \
--hash-algorithm SHA-256 \
--key access-pk.pem
```

*(you can also pipe the access-token like `cat access-token.txt | rusty-jwt-cli verify-access ...`)*

### `generate-access`

Prints a sample access token to stdout for testing purposes.

Let's first generate a sample Ed25519 KeyPair in a file

```bash
openssl genpkey -algorithm ed25519 -outform PEM -out access-kp.pem
```

```bash
rusty-jwt-cli generate-access \
--challenge okAJ33Ym/XS2qmmhhh7aWSbBlYy4Ttm1EysqW8I/9ng \
--nonce WE88EvOBzbqGerznM+2P/AadVf7374y0cH19sDSZA2A \
--htu https://wire.example.com/clients/token \
--client-id wireapp://lJGYPz0ZRq2kvc_XpdaDlA!211a945dca45eed1@wire.com \
--expiry 300 \
--key access-kp.pem
```

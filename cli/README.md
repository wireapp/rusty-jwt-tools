# rusty-jwt-cli

A cli to prototype JWTs and tryout this project.

## Installation

```bash
cargo install --git https://github.com/wireapp/rusty-jwt-tools.git
```

To update do:
```bash
cargo install --force --git https://github.com/wireapp/rusty-jwt-tools.git
```

## Generate PEM KeyPairs

### Ed25519

```bash
openssl genpkey -algorithm ed25519 -outform PEM -out kp-ed25519.pem
```

### ES256

```bash
openssl ecparam -genkey -name prime256v1 | openssl pkcs8 -topk8 -nocrypt -out kp-p256.pem 
```

### ES384

```bash
openssl ecparam -genkey -name secp384r1 | openssl pkcs8 -topk8 -nocrypt -out kp-p384.pem 
```

## Usage

### `jwt-build`

Generates a new JWT token. For sample payloads have a look in [this folder](../data).

```bash
cat claims.json | rusty-jwt-cli jwt-build -k kp-ed25519.pem -p vp.json -c vc1.json -c vc2.json
# or
rusty-jwt-cli jwt-build claims.json -k kp-ed25519.pem -p vp.json -c vc1.json -c vc2.json
```

### `jwt-parse`

Introspects and verifies a JWT token

```bash
cat jwt.json | rusty-jwt-cli jwt-parse
# or
rusty-jwt-cli jwt-parse jwt.json
```

### `jwk-parse`

Turns a PEM private into its public key JWK representation and computes its thumbprint according to RFC7638.

```bash
cat kp-p256.pem | rusty-jwt-cli jwk-parse
# or
rusty-jwt-cli jwk-parse kp-p256.pem
```

### `access-verify`

Verifies an access token generated by wire-server. To generate a sample one you can

```bash
git clone https://github.com/wireapp/rusty-jwt-tools.git &&
cd rusty-jwt-tools &&
cargo test --test e2e -- --show-output
```

For example for an Ed25519 token let store it in a file

```bash
cat <<EOF >> access-pk.pem
-----BEGIN PUBLIC KEY-----
MCowBQYDK2VwAyEAKG4odfk6mCgwi8QscttETsh9tPFGsSX9pKTyXPOlKi4=
-----END PUBLIC KEY-----
EOF
```

Then also store a sample token in a file:

```bash
echo "eyJhbGciOiJFZERTQSIsInR5cCI6ImF0K2p3dCIsImp3ayI6eyJrdHkiOiJPS1AiLCJjcnYiOiJFZDI1NTE5IiwieCI6IktHNG9kZms2bUNnd2k4UXNjdHRFVHNoOXRQRkdzU1g5cEtUeVhQT2xLaTQifX0.eyJpYXQiOjE2Njk5ODMwOTEsImV4cCI6MTY3Nzc1OTA5MSwibmJmIjoxNjY5OTgzMDkxLCJpc3MiOiJodHRwczovL3dpcmUuZXhhbXBsZS5jb20vY2xpZW50cy8yMzg1MzgyMDgzMTkyNTQ5MDczL2FjY2Vzcy10b2tlbiIsInN1YiI6ImltOndpcmVhcHA6WWpReU5ERTRZV1ZqWXpkaU5HWmxZams0TnpoaE5EazVZVGRtTW1VNE5UTS8yMTFhOTQ1ZGNhNDVlZWQxQHdpcmUuY29tIiwiYXVkIjoiaHR0cHM6Ly93aXJlLmV4YW1wbGUuY29tL2NsaWVudHMvMjM4NTM4MjA4MzE5MjU0OTA3My9hY2Nlc3MtdG9rZW4iLCJqdGkiOiIxMDQ0YjU2Yy01OTE5LTRmODktYmI1YS00MmQ3N2RlMTUwNDAiLCJub25jZSI6IldFODhFdk9CemJxR2Vyem5NKzJQL0FhZFZmNzM3NHkwY0gxOXNEU1pBMkEiLCJjaGFsIjoib2tBSjMzWW0vWFMycW1taGhoN2FXU2JCbFl5NFR0bTFFeXNxVzhJLzluZyIsImNuZiI6eyJraWQiOiJBbjY3NXVPQVlJbk5Cckg0Rk9KUThyN3ZvOGZKWmtWT2R5WERhdmpHS084In0sInByb29mIjoiZXlKaGJHY2lPaUpGWkVSVFFTSXNJblI1Y0NJNkltUndiM0FyYW5kMElpd2lhbmRySWpwN0ltdDBlU0k2SWs5TFVDSXNJbU55ZGlJNklrVmtNalUxTVRraUxDSjRJam9pZFRkc1dFZHRiWGwyVTNSbGFEWnRYMWt0U1d0bWNHbGhXVVZvYURsNE1WVlZaV05yV2pWT2FGRmtieUo5ZlEuZXlKcFlYUWlPakUyTmprNU9ETXdPVEVzSW1WNGNDSTZNVFkzTURBMk9UUTVNU3dpYm1KbUlqb3hOalk1T1Rnek1Ea3hMQ0p6ZFdJaU9pSnBiVHAzYVhKbFlYQndPbGxxVVhsT1JFVTBXVmRXYWxsNlpHbE9SMXBzV1dwck5FNTZhR2hPUkdzMVdWUmtiVTF0VlRST1ZFMHZNakV4WVRrME5XUmpZVFExWldWa01VQjNhWEpsTG1OdmJTSXNJbXAwYVNJNklqVTBOalkwWWpaa0xUVTFZell0TkdSa01pMWlNREJtTFdJM01tTTJabVF6TldNeE55SXNJbTV2Ym1ObElqb2lWMFU0T0VWMlQwSjZZbkZIWlhKNmJrMHJNbEF2UVdGa1ZtWTNNemMwZVRCalNERTVjMFJUV2tFeVFTSXNJbWgwYlNJNklsQlBVMVFpTENKb2RIVWlPaUpvZEhSd2N6b3ZMM2RwY21VdVpYaGhiWEJzWlM1amIyMHZZMnhwWlc1MGN5OHlNemcxTXpneU1EZ3pNVGt5TlRRNU1EY3pMMkZqWTJWemN5MTBiMnRsYmlJc0ltTm9ZV3dpT2lKdmEwRktNek5aYlM5WVV6SnhiVzFvYUdnM1lWZFRZa0pzV1hrMFZIUnRNVVY1YzNGWE9Fa3ZPVzVuSW4wLnlva3FtSUlEMGt1R2NfNGdHOFY4SnVnWTZHZ18tWksxc0hoOFc5NlZ5MGxBR0dfZkk0bW1QOXd2d0gzMUpOYUxuTGExaVhTSjVELXZtZkhQb0ZsOUF3IiwiY2xpZW50X2lkIjoiaW06d2lyZWFwcDpZalF5TkRFNFlXVmpZemRpTkdabFlqazROemhoTkRrNVlUZG1NbVU0TlRNLzIxMWE5NDVkY2E0NWVlZDFAd2lyZS5jb20iLCJhcGlfdmVyc2lvbiI6Mywic2NvcGUiOiJ3aXJlX2NsaWVudF9pZCJ9.ouLB8zv8jhCR_hk_b58wohBEvdgZ1FSPWlajAPSBNRJ14pASH2yZUBVVnC4dz-vNQ4hEaoLeNpmtUKFwiNfHAQ" > access-token.txt
```

And verify it like this

```bash
rusty-jwt-cli verify-access access-token.txt \
--client-id im:wireapp:YjQyNDE4YWVjYzdiNGZlYjk4NzhhNDk5YTdmMmU4NTM/211a945dca45eed1@wire.com \
--challenge okAJ33Ym/XS2qmmhhh7aWSbBlYy4Ttm1EysqW8I/9ng \
--leeway 360 \
--max-expiry 2080200819 \
--hash-algorithm "SHA-256" \
--key access-pk.pem
```

*(you can also pipe the access-token like `cat access-token.txt | rusty-jwt-cli verify-access ...`)*
